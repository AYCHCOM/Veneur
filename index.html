<html lang="en">
    <head>
        <title>WebSocket Example</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>
    </head>
    <body>
        <div id="chart"></div>
        <pre id="fileData">{{.Data}}</pre>
        <script type="text/javascript">
            (function() {
                exes = []
                whys = []
                var chart = c3.generate({
                  bindto: '#chart',
                  data: {
                     x: 'x',
                     xFormat: "%Y-%m-%dT%H:%M:%S.%LZ",
                    columns: [
                    ]
                  },
                  axis: {
                    x: {
                      type: 'timeseries',
                      ticket: {
                        format: '%c'
                      }
                    }
                  }
                });
                var data = document.getElementById("fileData");
                var conn = new WebSocket("ws://localhost:8080/ws");
                conn.onclose = function(evt) {
                    data.textContent = 'Connection closed';
                }
                conn.onmessage = function(evt) {
                  data.textContent = evt.data;
                  result = JSON.parse(evt.data);
                  var arrayLength = result['series'].length;
                  for (var i = 0; i < arrayLength; i++) {
                    series = result['series'][i];
                    if (series['metric'] === "gauge.veneur") {
                      console.log(series)
                      date = new Date(series['points'][0][0]*1000)
                      if(exes.length == 0) {
                        exes.push('x')
                        whys.push(series['metric'])
                      }
                      if(exes.length >= 3) {
                        exes = ['x'].concat(exes.slice(-2))
                        whys = [series['metric']].concat(whys.slice(-2))
                      }
                      exes.push(date.toISOString())
                      whys.push(series['points'][0][1])
                    }
                  }
                  console.log(exes)
                  console.log(whys)
                  chart.load({
                    columns: [
                        exes, whys
                    ]
                  })
                }
            })();
        </script>
    </body>
</html>
